<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–ê–≤—Ç–æ –∑ –°–®–ê</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root{--bg:#0a0a0a;--card:#141414;--card2:#1c1c1c;--line:#252525;--gold:#d4a843;--red:#e05252;--text:#efefef;--text2:#777;--text3:#3a3a3a;--r:16px}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{background:var(--bg);color:var(--text);font-family:-apple-system,'SF Pro Display',sans-serif;min-height:100vh;overscroll-behavior:none}
.hdr{position:sticky;top:0;z-index:50;background:rgba(10,10,10,.96);backdrop-filter:blur(24px);border-bottom:1px solid var(--line);padding:14px 16px 12px}
.hdr-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.brand{font-size:20px;font-weight:900;letter-spacing:-1px}
.brand em{color:var(--gold);font-style:normal}
.chip{background:var(--card2);border:1px solid var(--line);color:var(--text2);font-size:12px;font-weight:700;padding:4px 12px;border-radius:20px}
.srch{position:relative}
.srch input{width:100%;background:var(--card2);border:1.5px solid var(--line);border-radius:12px;padding:10px 14px 10px 40px;color:var(--text);font-size:14px;outline:none;transition:border .2s}
.srch input:focus{border-color:var(--gold)}
.srch input::placeholder{color:var(--text3)}
.srch-ic{position:absolute;left:13px;top:50%;transform:translateY(-50%);color:var(--text3);font-size:15px;pointer-events:none}
/* FILTER ROWS */
.frow{display:flex;gap:8px;overflow-x:auto;scrollbar-width:none;padding:8px 16px 0}
.frow::-webkit-scrollbar{display:none}
.frow-label{font-size:10px;color:var(--text3);font-weight:700;padding:0 16px 4px;letter-spacing:.5px;text-transform:uppercase}
.fbtn{flex-shrink:0;background:var(--card2);border:1.5px solid var(--line);color:var(--text2);font-size:12px;font-weight:700;padding:6px 16px;border-radius:20px;cursor:pointer;white-space:nowrap;transition:all .15s}
.fbtn.on{background:var(--gold);border-color:var(--gold);color:#000}
/* SELECTS */
.selrow{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:8px 16px 0}
.fsel{width:100%;background:var(--card2);border:1.5px solid var(--line);color:var(--text2);font-size:12px;font-weight:700;padding:7px 12px;border-radius:20px;cursor:pointer;outline:none;appearance:none;-webkit-appearance:none}
.fsel.on{border-color:var(--gold);color:var(--gold)}
.sortbar{display:flex;align-items:center;gap:7px;padding:8px 16px 10px;overflow-x:auto;scrollbar-width:none}
.sortbar::-webkit-scrollbar{display:none}
.slbl{font-size:11px;color:var(--text3);font-weight:600;white-space:nowrap;flex-shrink:0}
.sbtn{flex-shrink:0;background:none;border:1.5px solid var(--line);color:var(--text2);font-size:11px;font-weight:700;padding:5px 12px;border-radius:20px;cursor:pointer;white-space:nowrap;transition:all .15s}
.sbtn.on{border-color:var(--gold);color:var(--gold)}
.list{padding:4px 12px 120px;display:flex;flex-direction:column;gap:10px}
.card{background:var(--card);border:1.5px solid var(--line);border-radius:var(--r);overflow:hidden;cursor:pointer;transition:transform .15s,border-color .15s}
.card:active{transform:scale(.985);border-color:var(--gold)}
.card-img{width:100%;aspect-ratio:16/10;object-fit:cover;display:block;background:var(--card2)}
.card-img-ph{width:100%;aspect-ratio:16/10;display:flex;align-items:center;justify-content:center;background:var(--card2);font-size:40px;color:var(--text3)}
.card-body{padding:13px 14px 14px}
.card-name{font-size:17px;font-weight:800;letter-spacing:-.4px;margin-bottom:2px}
.card-vin{font-size:11px;color:var(--text2);font-family:monospace;margin-bottom:11px}
.card-row{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:9px}
.card-price{font-size:24px;font-weight:900;color:var(--gold);letter-spacing:-.5px}
.card-price-lbl{font-size:10px;color:var(--text2);margin-top:1px}
.card-price-ua{font-size:13px;font-weight:700;color:#5bb4ff;margin-top:2px}
.tags{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
.tag{background:var(--card2);border:1px solid var(--line);color:var(--text2);font-size:11px;font-weight:600;padding:3px 9px;border-radius:7px}
.tag.dmg{background:rgba(224,82,82,.08);border-color:rgba(224,82,82,.3);color:var(--red)}
.btn-order-card{width:100%;background:var(--gold);color:#000;font-size:14px;font-weight:900;border:none;padding:11px;border-radius:10px;cursor:pointer;margin-top:2px}
.btn-order-card:active{opacity:.8}
.detail{position:fixed;inset:0;z-index:100;background:var(--bg);overflow-y:auto;overscroll-behavior:contain;transform:translateY(100%);transition:transform .35s cubic-bezier(.32,.72,0,1)}
.detail.open{transform:translateY(0)}
.d-hdr{position:sticky;top:0;z-index:10;background:rgba(10,10,10,.96);backdrop-filter:blur(24px);border-bottom:1px solid var(--line);padding:12px 16px;display:flex;align-items:center;gap:12px}
.back{width:38px;height:38px;border-radius:50%;background:var(--card2);border:1.5px solid var(--line);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:18px;flex-shrink:0;transition:background .15s}
.back:active{background:var(--card)}
.d-hdr-name{font-size:15px;font-weight:800;line-height:1.2}
.d-hdr-vin{font-size:11px;color:var(--text2);font-family:monospace}
.gal{background:#000;position:relative}
.gal-slides{display:flex;overflow-x:auto;scroll-snap-type:x mandatory;scrollbar-width:none}
.gal-slides::-webkit-scrollbar{display:none}
.gal-slide{flex-shrink:0;width:100%;scroll-snap-align:start;aspect-ratio:4/3}
.gal-slide img{width:100%;height:100%;object-fit:cover}
.gal-count{position:absolute;bottom:12px;right:14px;background:rgba(0,0,0,.65);backdrop-filter:blur(8px);color:#fff;font-size:12px;font-weight:700;padding:4px 11px;border-radius:20px}
.gal-dots{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);display:flex;gap:5px}
.dot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.35);transition:all .2s}
.dot.on{background:#fff;transform:scale(1.35)}
.d-body{padding:16px 16px 130px}
.price-block{background:var(--card);border:1.5px solid var(--line);border-radius:var(--r);padding:18px 16px;margin-bottom:14px}
.d-price{font-size:22px;font-weight:800;color:var(--gold);letter-spacing:-.5px}
.d-price-lbl{font-size:11px;color:var(--text2);margin-top:3px}
.d-price-ua{font-size:34px;font-weight:900;color:#5bb4ff;letter-spacing:-1.5px;margin-top:6px}
.d-price-ua-lbl{font-size:11px;color:var(--text2);margin-top:2px}
.dmg-block{background:rgba(224,82,82,.07);border:1.5px solid rgba(224,82,82,.2);border-radius:12px;padding:12px 14px;margin-bottom:14px}
.dmg-ttl{font-size:11px;font-weight:800;color:var(--red);letter-spacing:.5px;margin-bottom:5px}
.dmg-txt{font-size:13px;color:var(--text);line-height:1.4}
.sec-ttl{font-size:11px;font-weight:800;color:var(--text3);letter-spacing:.8px;text-transform:uppercase;margin:18px 0 10px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.spec{background:var(--card);border:1.5px solid var(--line);border-radius:12px;padding:11px 13px}
.spec-lbl{font-size:10px;color:var(--text2);font-weight:600;margin-bottom:3px}
.spec-val{font-size:14px;font-weight:800;line-height:1.2}
.vin-block{background:var(--card);border:1.5px solid var(--line);border-radius:12px;padding:13px 14px;cursor:pointer;transition:border-color .15s}
.vin-block:active{border-color:var(--gold)}
.vin-hint{font-size:11px;color:var(--text2);margin-bottom:4px}
.vin-num{font-family:monospace;font-size:15px;font-weight:700;letter-spacing:1.5px}
.abar{position:fixed;bottom:0;left:0;right:0;z-index:200;background:rgba(10,10,10,.97);backdrop-filter:blur(24px);border-top:1px solid var(--line);padding:12px 16px max(20px,env(safe-area-inset-bottom));display:none;gap:10px}
.btn-main{flex:1;background:var(--gold);color:#000;font-size:15px;font-weight:900;border:none;padding:15px;border-radius:13px;cursor:pointer;transition:opacity .15s}
.btn-main:active{opacity:.8}
.btn-order{flex:1;background:var(--gold);color:#000;font-size:15px;font-weight:900;border:none;padding:15px;border-radius:13px;cursor:pointer;transition:opacity .15s}
.btn-order:active{opacity:.8}
.btn-sec{background:var(--card2);border:1.5px solid var(--line);color:var(--text);font-size:15px;font-weight:700;padding:15px 18px;border-radius:13px;cursor:pointer;transition:background .15s;white-space:nowrap}
.btn-sec:active{background:var(--card)}
.empty{text-align:center;padding:80px 20px;color:var(--text3)}
.empty-ic{font-size:52px;margin-bottom:14px}
.empty-tx{font-size:15px;font-weight:600}
.loading{text-align:center;padding:80px 20px;color:var(--text2);font-size:15px}
</style>
</head>
<body>

<div id="listView">
  <div class="hdr">
    <div class="hdr-top">
      <div class="brand">–ê–í–¢–û<em>–ë–û–¢</em></div>
      <div class="chip" id="countChip">...</div>
    </div>
    <div class="srch">
      <span class="srch-ic">üîç</span>
      <input id="srchInput" placeholder="–ú–∞—Ä–∫–∞, –º–æ–¥–µ–ª—å, VIN‚Ä¶" type="search" autocomplete="off">
    </div>
  </div>

  <div class="frow" id="makeFilter"></div>

  <div class="selrow">
    <select class="fsel" id="modelSel"><option value="">–í—Å—ñ –º–æ–¥–µ–ª—ñ</option></select>
    <select class="fsel" id="yearSel"><option value="">–í—Å—ñ —Ä–æ–∫–∏</option></select>
  </div>

  <div class="sortbar">
    <span class="slbl">–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è:</span>
    <button class="sbtn on" data-s="price-asc">–¶—ñ–Ω–∞ ‚Üë</button>
    <button class="sbtn" data-s="price-desc">–¶—ñ–Ω–∞ ‚Üì</button>
    <button class="sbtn" data-s="year-desc">–ù–æ–≤—ñ—à—ñ</button>
  </div>
  <div class="list" id="carList"><div class="loading">‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div></div>
</div>

<div class="detail" id="detailView">
  <div class="d-hdr">
    <div class="back" id="backBtn">‚Üê</div>
    <div>
      <div class="d-hdr-name" id="dName"></div>
      <div class="d-hdr-vin" id="dVin"></div>
    </div>
  </div>
  <div class="gal" id="dGal"></div>
  <div class="d-body" id="dBody"></div>
</div>

<div class="abar" id="actionBar">
  <button class="btn-sec" id="btnShare">üì§ –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—å</button>
  <button class="btn-order" id="btnOrder">üöó –ó–∞–º–æ–≤–∏—Ç–∏ –∞–≤—Ç–æ</button>
</div>

<script>
const tg = window.Telegram?.WebApp;
if(tg){tg.expand();tg.ready();}

const ORDER_URL = 'https://t.me/cars24club_bot?start=699f5656fd7eb6c22c0d9a82';

let CARS=[], filterMake='all', filterModel='', filterYear='', sort='price-asc', query='', activeCar=null;

fetch('cars.json')
  .then(r=>r.json())
  .then(data=>{CARS=data;buildFilters();render();})
  .catch(()=>{document.getElementById('carList').innerHTML='<div class="empty"><div class="empty-ic">‚ùå</div><div class="empty-tx">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</div></div>';});

function buildFilters(){
  // –ú–∞—Ä–∫–∏ ‚Äî –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
  const makes=[...new Set(CARS.map(c=>c.make).filter(Boolean))].sort();
  const fw=document.getElementById('makeFilter');
  fw.innerHTML='';
  ['all',...makes].forEach(m=>{
    const b=document.createElement('button');
    b.className='fbtn'+(m==='all'?' on':'');
    b.textContent=m==='all'?'–í—Å—ñ':m;
    b.onclick=()=>{
      filterMake=m; filterModel=''; filterYear='';
      fw.querySelectorAll('.fbtn').forEach(x=>x.classList.remove('on'));
      b.classList.add('on');
      updateModelYearSelects();
      render();
    };
    fw.appendChild(b);
  });
  updateModelYearSelects();
}

function updateModelYearSelects(){
  const base = filterMake==='all' ? CARS : CARS.filter(c=>c.make===filterMake);

  // –ú–æ–¥–µ–ª–∏
  const models=[...new Set(base.map(c=>c.model).filter(Boolean))].sort();
  const ms=document.getElementById('modelSel');
  ms.innerHTML='<option value="">–í—Å—ñ –º–æ–¥–µ–ª—ñ</option>';
  models.forEach(m=>{const o=document.createElement('option');o.value=m;o.textContent=m;if(m===filterModel)o.selected=true;ms.appendChild(o);});
  ms.className='fsel'+(filterModel?' on':'');

  // –ì–æ–¥—ã
  const years=[...new Set(base.map(c=>c.year).filter(Boolean))].sort((a,b)=>b-a);
  const ys=document.getElementById('yearSel');
  ys.innerHTML='<option value="">–í—Å—ñ —Ä–æ–∫–∏</option>';
  years.forEach(y=>{const o=document.createElement('option');o.value=y;o.textContent=y;if(String(y)===String(filterYear))o.selected=true;ys.appendChild(o);});
  ys.className='fsel'+(filterYear?' on':'');
}

document.getElementById('modelSel').addEventListener('change',e=>{filterModel=e.target.value;e.target.className='fsel'+(filterModel?' on':'');render();});
document.getElementById('yearSel').addEventListener('change',e=>{filterYear=e.target.value;e.target.className='fsel'+(filterYear?' on':'');render();});

document.querySelectorAll('.sbtn').forEach(b=>{
  b.onclick=()=>{sort=b.dataset.s;document.querySelectorAll('.sbtn').forEach(x=>x.classList.remove('on'));b.classList.add('on');render();};
});
document.getElementById('srchInput').addEventListener('input',e=>{query=e.target.value.trim();render();});

function fmt(n){return n?Number(n).toLocaleString('uk-UA'):'‚Äî';}

function filtered(){
  let list=[...CARS];
  if(filterMake!=='all') list=list.filter(c=>c.make===filterMake);
  if(filterModel) list=list.filter(c=>c.model===filterModel);
  if(filterYear)  list=list.filter(c=>String(c.year)===String(filterYear));
  if(query){
    const q=query.toLowerCase();
    list=list.filter(c=>(c.make||'').toLowerCase().includes(q)||(c.model||'').toLowerCase().includes(q)||(c.vin||'').toLowerCase().includes(q)||String(c.year||'').includes(q));
  }
  list.sort((a,b)=>{
    if(sort==='price-asc')  return (a.price||0)-(b.price||0);
    if(sort==='price-desc') return (b.price||0)-(a.price||0);
    if(sort==='year-desc')  return (b.year||0)-(a.year||0);
    return 0;
  });
  return list;
}

function orderCar(e, vin){
  e.stopPropagation();
  if(tg) tg.openLink(ORDER_URL);
  else window.open(ORDER_URL,'_blank');
}

function render(){
  const list=filtered();
  document.getElementById('countChip').textContent=list.length+' –∞–≤—Ç–æ';
  const el=document.getElementById('carList');
  if(!list.length){el.innerHTML='<div class="empty"><div class="empty-ic">üîç</div><div class="empty-tx">–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div></div>';return;}
  el.innerHTML=list.map(c=>{
    const photo=c.photos&&c.photos[0]?`<img class="card-img" src="${c.photos[0]}" loading="lazy" alt="" onerror="this.parentElement.innerHTML='<div class=card-img-ph>üöó</div>'">`:`<div class="card-img-ph">üöó</div>`;
    const mi=c.mileage?`${fmt(c.mileage)} mi`:'';
    const eng=c.engine?`${c.engine}L`:'';
    const tags=[mi,eng,c.transmission].filter(Boolean);
    const dmg=c.damage?c.damage.replace(/^–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ /i,''):'';
    return `<div class="card" onclick="openCar('${c.vin}')">
      ${photo}
      <div class="card-body">
        <div class="card-name">${c.year||''} ${c.make||''} ${c.model||''}</div>
        <div class="card-vin">${c.vin}</div>
        <div class="card-row">
          <div>
            <div class="card-price">$${fmt(c.price)}</div>
            <div class="card-price-lbl">–∞—É–∫—Ü—ñ–æ–Ω</div>
            ${c.price_ua?`<div class="card-price-ua">$${fmt(c.price_ua)} –≤ –£–∫—Ä–∞—ó–Ω—ñ</div>`:''}
          </div>
        </div>
        <div class="tags">
          ${tags.map(t=>`<span class="tag">${t}</span>`).join('')}
          ${dmg?`<span class="tag dmg">‚ö† ${dmg}</span>`:''}
        </div>
        <button class="btn-order-card" onclick="orderCar(event,'${c.vin}')">üöó –ó–∞–º–æ–≤–∏—Ç–∏ –∞–≤—Ç–æ</button>
      </div>
    </div>`;
  }).join('');
}

function openCar(vin){
  activeCar=CARS.find(c=>c.vin===vin);
  if(!activeCar) return;
  const c=activeCar;
  document.getElementById('dName').textContent=`${c.year||''} ${c.make||''} ${c.model||''}`;
  document.getElementById('dVin').textContent=c.vin;
  const gal=document.getElementById('dGal');
  if(c.photos&&c.photos.length){
    gal.innerHTML=`<div class="gal-slides" id="galSlides">${c.photos.map(p=>`<div class="gal-slide"><img src="${p}" loading="lazy" alt=""></div>`).join('')}</div><div class="gal-count"><span id="galIdx">1</span>/${c.photos.length}</div><div class="gal-dots">${c.photos.map((_,i)=>`<div class="dot${i===0?' on':''}" id="gd${i}"></div>`).join('')}</div>`;
    document.getElementById('galSlides').addEventListener('scroll',function(){
      const i=Math.round(this.scrollLeft/this.offsetWidth);
      document.getElementById('galIdx').textContent=i+1;
      c.photos.forEach((_,j)=>{const d=document.getElementById('gd'+j);if(d)d.className='dot'+(j===i?' on':'');});
    },{passive:true});
  } else {
    gal.innerHTML=`<div class="card-img-ph" style="aspect-ratio:4/3">üöó</div>`;
  }
  const specs=[
    ['–†—ñ–∫ –≤–∏–ø—É—Å–∫—É',c.year],['–ö—É–∑–æ–≤',c.body_type],
    ['–ü—Ä–æ–±—ñ–≥',c.mileage?fmt(c.mileage)+' mi':null],
    ['–î–≤–∏–≥—É–Ω',c.engine?c.engine+'L':null],
    ['–ü–∞–ª—å–Ω–µ',c.fuel],['–ö–ü–ü',c.transmission],['–ü—Ä–∏–≤—ñ–¥',c.drive],
  ].filter(([,v])=>v);
  document.getElementById('dBody').innerHTML=`
    <div class="price-block">
      <div class="d-price">$${fmt(c.price)}</div>
      <div class="d-price-lbl">—Ü—ñ–Ω–∞ –∞—É–∫—Ü—ñ–æ–Ω—É</div>
      ${c.price_ua?`<div class="d-price-ua">$${fmt(c.price_ua)}</div><div class="d-price-ua-lbl">—Ü—ñ–Ω–∞ –≤ –£–∫—Ä–∞—ó–Ω—ñ</div>`:''}
    </div>
    ${c.damage?`<div class="dmg-block"><div class="dmg-ttl">‚ö† –ü–û–®–ö–û–î–ñ–ï–ù–ù–Ø</div><div class="dmg-txt">${c.damage}</div></div>`:''}
    <div class="sec-ttl">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</div>
    <div class="grid">${specs.map(([l,v2])=>`<div class="spec"><div class="spec-lbl">${l}</div><div class="spec-val">${v2}</div></div>`).join('')}</div>
    <div class="sec-ttl">VIN-–∫–æ–¥</div>
    <div class="vin-block" onclick="copyVin('${c.vin}')">
      <div class="vin-hint">üìã –ù–∞—Ç–∏—Å–Ω–∏ –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è</div>
      <div class="vin-num">${c.vin}</div>
    </div>`;
  document.getElementById('detailView').classList.add('open');
  document.getElementById('actionBar').style.display='flex';
  if(tg?.BackButton){tg.BackButton.show();tg.BackButton.onClick(closeCar);}
}

function closeCar(){
  document.getElementById('detailView').classList.remove('open');
  document.getElementById('actionBar').style.display='none';
  activeCar=null;
  if(tg?.BackButton) tg.BackButton.hide();
}
function copyVin(v){
  navigator.clipboard?.writeText(v).then(()=>{if(tg)tg.showAlert('VIN —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ:\n'+v);else alert('VIN: '+v);});
}
document.getElementById('backBtn').onclick=closeCar;
document.getElementById('btnOrder').onclick=()=>{
  if(tg) tg.openLink(ORDER_URL);
  else window.open(ORDER_URL,'_blank');
};
document.getElementById('btnShare').onclick=()=>{
  if(!activeCar) return;
  const c=activeCar;
  const txt=`${c.year} ${c.make} ${c.model} ‚Äî $${fmt(c.price)}\nVIN: ${c.vin}`;
  if(tg) tg.switchInlineQuery(txt);
  else navigator.clipboard?.writeText(txt);
};
</script>
</body>
</html>